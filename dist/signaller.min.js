!function(e){if("function"==typeof bootstrap)bootstrap("signaller",e);else if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeSignaller=e}else"undefined"!=typeof window?window.signaller=e():global.signaller=e()}(function(){var define,ses,bootstrap,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){"use strict";module.exports=function(scope){return function(args){try{scope.emit("announce",JSON.parse(args[0]))}catch(e){}}}},{}],2:[function(require,module,exports){"use strict";module.exports=function(scope){return{announce:require("./announce")(scope),request:require("./request")(scope)}}},{"./announce":1,"./request":3}],3:[function(require,module,exports){"use strict";module.exports=function(scope){var attributes=scope.attributes;function ackRequest(data){var listeners=scope.listeners("request");if(listeners&&listeners.length>0){}scope.send("/to",data.__srcid,"/ackreq",data.__reqid,scope.id)}return function(data){var match=true;var testKeys;try{data=JSON.parse(data)}catch(e){return false}testKeys=Object.keys(data).filter(function(key){return key.charAt(0)!=="_"});match=testKeys.reduce(function(memo,key){return memo&&attributes[key]===data[key]},match);if(match){if(scope.blocks.length){return scope.on("unblock",function(){ackRequest(data)})}return ackRequest(data)}return false}}},{}],4:[function(require,module,exports){"use strict";var EventEmitter=require("events").EventEmitter;var uuid=require("uuid");var extend=require("cog/extend");module.exports=function(messenger,opts){var scope=new EventEmitter;var id=scope.id=uuid.v4();var attributes=scope.attributes={id:id};var dataEvent=(opts||{}).dataEvent||"data";scope.blocks=[];scope.matchers=[];function createChannel(targetId){return{send:function(){send.apply(null,["/to",targetId].concat([].slice.call(arguments)))}}}function once(prefix,handler){scope.matchers.push({prefix:prefix,handler:handler})}var send=scope.send=function(){var params=[].slice.call(arguments).map(function(data){if(typeof data=="object"&&!(data instanceof String)){return JSON.stringify(data)}else if(typeof data=="function"){return null}return data}).filter(Boolean);return messenger.send(params.join("|"))};scope.announce=function(data){extend(attributes,data,{id:id});return send("/announce",attributes)};scope.block=function(){var id=uuid.v4();scope.blocks.push(id);return id};scope.clearBlock=function(id){var wasBlocked=scope.blocks.length>0;scope.blocks=scope.blocks.filter(function(blockId){return blockId!==id});if(wasBlocked&&scope.blocks.length===0){scope.emit("unblock")}};scope.leave=function(){return send("/leave",{id:id})};scope.request=function(data,opts,callback){var reqid=uuid.v4();if(typeof opts=="function"){callback=opts;opts={}}once("/ackreq|"+reqid,function(data){var targetId=data.split("|")[2];callback(null,createChannel(targetId))});send("/request",extend({},data,{__srcid:id,__reqid:reqid}))};messenger.on(dataEvent,require("./processor")(scope));return scope}},{"./processor":9,"cog/extend":6,events:5,uuid:8}],5:[function(require,module,exports){var process=require("__browserify_process");if(!process.EventEmitter)process.EventEmitter=function(){};var EventEmitter=exports.EventEmitter=process.EventEmitter;var isArray=typeof Array.isArray==="function"?Array.isArray:function(xs){return Object.prototype.toString.call(xs)==="[object Array]"};function indexOf(xs,x){if(xs.indexOf)return xs.indexOf(x);for(var i=0;i<xs.length;i++){if(x===xs[i])return i}return-1}var defaultMaxListeners=10;EventEmitter.prototype.setMaxListeners=function(n){if(!this._events)this._events={};this._events.maxListeners=n};EventEmitter.prototype.emit=function(type){if(type==="error"){if(!this._events||!this._events.error||isArray(this._events.error)&&!this._events.error.length){if(arguments[1]instanceof Error){throw arguments[1]}else{throw new Error("Uncaught, unspecified 'error' event.")}return false}}if(!this._events)return false;var handler=this._events[type];if(!handler)return false;if(typeof handler=="function"){switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:var args=Array.prototype.slice.call(arguments,1);handler.apply(this,args)}return true}else if(isArray(handler)){var args=Array.prototype.slice.call(arguments,1);var listeners=handler.slice();for(var i=0,l=listeners.length;i<l;i++){listeners[i].apply(this,args)}return true}else{return false}};EventEmitter.prototype.addListener=function(type,listener){if("function"!==typeof listener){throw new Error("addListener only takes instances of Function")}if(!this._events)this._events={};this.emit("newListener",type,listener);if(!this._events[type]){this._events[type]=listener}else if(isArray(this._events[type])){if(!this._events[type].warned){var m;if(this._events.maxListeners!==undefined){m=this._events.maxListeners}else{m=defaultMaxListeners}if(m&&m>0&&this._events[type].length>m){this._events[type].warned=true;console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this._events[type].length);console.trace()}}this._events[type].push(listener)}else{this._events[type]=[this._events[type],listener]}return this};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.once=function(type,listener){var self=this;self.on(type,function g(){self.removeListener(type,g);listener.apply(this,arguments)});return this};EventEmitter.prototype.removeListener=function(type,listener){if("function"!==typeof listener){throw new Error("removeListener only takes instances of Function")}if(!this._events||!this._events[type])return this;var list=this._events[type];if(isArray(list)){var i=indexOf(list,listener);if(i<0)return this;list.splice(i,1);if(list.length==0)delete this._events[type]}else if(this._events[type]===listener){delete this._events[type]}return this};EventEmitter.prototype.removeAllListeners=function(type){if(arguments.length===0){this._events={};return this}if(type&&this._events&&this._events[type])this._events[type]=null;return this};EventEmitter.prototype.listeners=function(type){if(!this._events)this._events={};if(!this._events[type])this._events[type]=[];if(!isArray(this._events[type])){this._events[type]=[this._events[type]]}return this._events[type]};EventEmitter.listenerCount=function(emitter,type){var ret;if(!emitter._events||!emitter._events[type])ret=0;else if(typeof emitter._events[type]==="function")ret=1;else ret=emitter._events[type].length;return ret}},{__browserify_process:11}],6:[function(require,module,exports){"use strict";module.exports=function(target){[].slice.call(arguments,1).forEach(function(source){if(!source){return}for(var prop in source){target[prop]=source[prop]}});return target}},{}],7:[function(require,module,exports){var global=require("__browserify_global");var rng;if(global.crypto&&crypto.getRandomValues){var _rnds8=new Uint8Array(16);rng=function whatwgRNG(){crypto.getRandomValues(_rnds8);return _rnds8}}if(!rng){var _rnds=new Array(16);rng=function(){for(var i=0,r;i<16;i++){if((i&3)===0)r=Math.random()*4294967296;_rnds[i]=r>>>((i&3)<<3)&255}return _rnds}}module.exports=rng},{__browserify_global:10}],8:[function(require,module,exports){var _rng=require("./rng");var BufferClass=typeof Buffer=="function"?Buffer:Array;var _byteToHex=[];var _hexToByte={};for(var i=0;i<256;i++){_byteToHex[i]=(i+256).toString(16).substr(1);_hexToByte[_byteToHex[i]]=i}function parse(s,buf,offset){var i=buf&&offset||0,ii=0;buf=buf||[];s.toLowerCase().replace(/[0-9a-f]{2}/g,function(oct){if(ii<16){buf[i+ii++]=_hexToByte[oct]}});while(ii<16){buf[i+ii++]=0}return buf}function unparse(buf,offset){var i=offset||0,bth=_byteToHex;return bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]}var _seedBytes=_rng();var _nodeId=[_seedBytes[0]|1,_seedBytes[1],_seedBytes[2],_seedBytes[3],_seedBytes[4],_seedBytes[5]];var _clockseq=(_seedBytes[6]<<8|_seedBytes[7])&16383;var _lastMSecs=0,_lastNSecs=0;function v1(options,buf,offset){var i=buf&&offset||0;var b=buf||[];options=options||{};var clockseq=options.clockseq!==undefined?options.clockseq:_clockseq;var msecs=options.msecs!==undefined?options.msecs:(new Date).getTime();var nsecs=options.nsecs!==undefined?options.nsecs:_lastNSecs+1;var dt=msecs-_lastMSecs+(nsecs-_lastNSecs)/1e4;if(dt<0&&options.clockseq===undefined){clockseq=clockseq+1&16383}if((dt<0||msecs>_lastMSecs)&&options.nsecs===undefined){nsecs=0}if(nsecs>=1e4){throw new Error("uuid.v1(): Can't create more than 10M uuids/sec")}_lastMSecs=msecs;_lastNSecs=nsecs;_clockseq=clockseq;msecs+=122192928e5;var tl=((msecs&268435455)*1e4+nsecs)%4294967296;b[i++]=tl>>>24&255;b[i++]=tl>>>16&255;b[i++]=tl>>>8&255;b[i++]=tl&255;var tmh=msecs/4294967296*1e4&268435455;b[i++]=tmh>>>8&255;b[i++]=tmh&255;b[i++]=tmh>>>24&15|16;b[i++]=tmh>>>16&255;b[i++]=clockseq>>>8|128;b[i++]=clockseq&255;var node=options.node||_nodeId;for(var n=0;n<6;n++){b[i+n]=node[n]}return buf?buf:unparse(b)}function v4(options,buf,offset){var i=buf&&offset||0;if(typeof options=="string"){buf=options=="binary"?new BufferClass(16):null;options=null}options=options||{};var rnds=options.random||(options.rng||_rng)();rnds[6]=rnds[6]&15|64;rnds[8]=rnds[8]&63|128;if(buf){for(var ii=0;ii<16;ii++){buf[i+ii]=rnds[ii]}}return buf||unparse(rnds)}var uuid=v4;uuid.v1=v1;uuid.v4=v4;uuid.parse=parse;uuid.unparse=unparse;uuid.BufferClass=BufferClass;module.exports=uuid},{"./rng":7}],9:[function(require,module,exports){"use strict";module.exports=function(scope){var id=scope.id;var handlers=require("./handlers")(scope);return function(data){var isMatch=true;var parts;var handler;if(data.slice(0,3)==="/to"){isMatch=data.slice(4,id.length+4)===id;if(isMatch){data=data.slice(5+id.length)}}if(!isMatch){return}parts=data.split("|");if(parts[0].charAt(0)==="/"){handler=handlers[parts[0].slice(1)];if(typeof handler=="function"){handler(parts.slice(1))}else{scope.emit.apply(scope,[parts[0].slice(1)].concat(parts.slice(1)))}}scope.matchers=scope.matchers.filter(function(rule){var exec=data.slice(0,rule.prefix.length)===rule.prefix;if(exec&&typeof rule.handler=="function"){rule.handler(data)}return!exec})}}},{"./handlers":2}],10:[function(require,module,exports){return{}},{}],11:[function(require,module,exports){return{}},{}]},{},[4])(4)});